{"version":3,"sources":["../../src/query_ctrl.js"],"names":["PredixTimeSeriesDatasourceQueryCtrl","$scope","$injector","templateSrv","uiSegmentSrv","target","attributes","filters","aggregations","groups","aggregator_types","name","description","datasource","getMetrics","then","transformToSegments","getAttributesForMetric","metric","getAttributeValues","_this","x","Promise","resolve","reject","mapToTextAndDescription","result","map","d","i","text","expandable","console","log","splice","indexOf","panelCtrl","refresh","push","value","measurements","qualities","type","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import angular from \"angular\";\nimport _ from \"lodash\";\nimport {\n    QueryCtrl\n} from 'app/plugins/sdk';\nimport './css/query-editor.css!';\n\nexport class PredixTimeSeriesDatasourceQueryCtrl extends QueryCtrl {\n    constructor($scope, $injector, templateSrv, uiSegmentSrv) {\n        super($scope, $injector);\n        this.uiSegmentSrv = uiSegmentSrv;\n        this.templateSrv = templateSrv;\n        this.target.attributes = [];\n        this.target.filters = [];\n        this.target.aggregations = [];\n        this.target.groups = [];\n        this.aggregator_types = [\n          {\n            name: \"avg\",\n            description: \"Returns the average of the values.\",\n          },\n          {\n            name: \"count\",\n            description: \"Counts the number of data points.\",\n          },\n          {\n            name: \"dev\",\n            description: \"Returns the standard deviation of the time series.\",\n          },\n          {\n            name: \"diff\",\n            description: \"Calculates the difference between successive data points.\",\n          },\n          {\n            name: \"div\",\n            description: \"Returns each data point divided by the specified value of the divisor property.\",\n          },\n          {\n            name: \"gaps\",\n            description: \"Marks gaps in data with a null data point, according to the sampling rate.\",\n          },\n          {\n            name: \"interpolate\",\n            description: \"Does linear interpolation for the chosen window.\",\n          },\n          {\n            name: \"least_squares\",\n            description: \"Returns two points that represent the best fit line through the set of data points for the range.\",\n          },\n          {\n            name: \"max\",\n            description: \"Inherits from the range aggregator. Returns the most recent largest value.\",\n          },\n          {\n            name: \"min\",\n            description: \"Returns the most recent smallest value.\",\n          },\n          {\n            name: \"percentile\",\n            description: \"Calculates a probability distribution, and returns the specified percentile for the distribution. The “percentile” value is defined as 0 < percentile <= 1 where .5 is 50% and 1 is 100%.\",\n          },\n          {\n            name: \"rate\",\n            description: \"Returns the rate of change between a pair of data points.\",\n          },\n          {\n            name: \"sampler\",\n            description: \"Calculates the sampling rate of change for the data points.\",\n          },\n          {\n            name: \"scale\",\n            description: \"Scales each data point by a factor.\",\n          },\n          {\n            name: \"sum\",\n            description: \"Returns the sum of all values.\",\n          },\n          {\n            name: \"trendmode\",\n            description: \"Returns the min and max values within each interval.\",\n          },\n\n        ];\n    }\n\n    getMetrics() {\n        return this.datasource.getMetrics()\n            .then(this.uiSegmentSrv.transformToSegments(true));\n    }\n\n    getAttributesForMetric() {\n      return this.datasource.getAttributesForMetric(this.target.metric)\n          .then(this.uiSegmentSrv.transformToSegments(true));\n    }\n\n    getAttributeValues(name) {\n      if (name) {\n        return this.datasource.getAttributeValues(this.target.metric, name)\n            .then(this.uiSegmentSrv.transformToSegments(true));\n      }\n    }\n\n    getAggregationTypes() {\n      var _this = this;\n      var x = new Promise(function(resolve, reject) {\n        resolve(_this.mapToTextAndDescription(_this.aggregator_types));\n      });\n      return x.then(this.uiSegmentSrv.transformToSegments(true));\n    }\n\n    mapToTextAndDescription(result) {\n        return _.map(result, function(d,i) {\n            return { text: d.name, expandable: false, description: d.description};\n        });\n    }\n\n    removeAttribute(name) {\n        console.log(\"Removing attribute\");\n        if (this.target.attributes) {\n            this.target.attributes.splice(this.target.attributes.indexOf(name), 1);\n            this.panelCtrl.refresh();\n        }\n    }\n\n    addAttribute() {\n        console.log(\"Add attribute...\");\n        this.target.attributes.push({\n            name: null,\n            value: null\n        });\n    }\n\n    addFilter() {\n        console.log(\"Add Filter...\");\n        this.target.filters.push({\n            attributes: {},\n            measurements: {},\n            qualities: {},\n        });\n    }\n\n    addGroup() {\n        console.log(\"Add Group...\");\n        this.target.groups.push({\n            name: null,\n            attributes: [],\n        });\n    }\n\n    addAggregation() {\n        console.log(\"Add Aggregation...\");\n        this.target.aggregations.push({\n            type: null\n        });\n        console.log(\"Add done..\");\n    }\n\n\n    onChangeInternal() {\n        this.panelCtrl.refresh(); // Asks the panel to refresh data.\n    }\n}\n\nPredixTimeSeriesDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n"]}